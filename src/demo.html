<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Title</title>
	<style>

	</style>
</head>
<body>
	<div class="person" data-gender="male"></div>
	<div id="child2" class="person" data-name="zhang"></div>
	<script src="../dist/jquery.js"></script>
	<script>
		var rbrace = /^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,
				rmultiDash = /[A-Z]/g;

		var expando = Math.random()
		var uid = 1

		function acceptData( owner ) {
			return owner.nodeType === 1 || owner.nodeType === 9 || !( +owner.nodeType );
		};
		class Data{
			constructor(){
				this.expando = expando + uid++
				console.log('expando', this.expando)
			}
			cache(owner) {
				var value = owner[this.expando]
				if(!value) {
				  value = {}
				  if(acceptData( owner )) {
						if(owner.nodeType) {
							owner[ this.expando ] = value
						}
					}
				}
				return value
			}
			set(owner, key, value) {
			  var cache,
						prop;
			  cache = this.cache(owner);

				if(typeof key === "string") {
					cache[ jQuery.camelCase( key ) ] = value;
				} else {

					// Copy the properties one-by-one to the cache object
					for ( prop in key ) {
						cache[ jQuery.camelCase( prop ) ] = key[ prop ];
					}
				}
				return cache
			}
			get(owner, key) {
			  return key === undefined ?
					this.cache(owner) :
						owner[ this.expando ] && owner[ this.expando ][ jQuery.camelCase( key ) ]
			}
			remove(owner, key) {

			}
		}

		var dataUser = new Data()
		var dataPriv = new Data()

		function dataAttr(elem, key, data) {
		  var name;
		  if(data === undefined && elem.nodeType === 1) {
				name = "data-" + key.replace( rmultiDash, "-$&" ).toLowerCase();
		    data = elem.getAttribute(name)
		   	try {
		      data = getData(data)
				} catch( e ){}
				dataUser.set(elem, name, data)
			}
			return data
		}

		function data(key, value){
			var data,
					attrs,
					length,
					name,
					elem = this[0];

			if(key === undefined) {
				data = dataUser.get(elem)
				if(this.length > 0) {
					if(!dataPriv.get(elem, "hasAttrbutes") && elem.nodeType === 1) {
						attrs = elem.attributes
						length = attrs.length
						while(length--) {
						  if(attrs[length]) {
								name = attrs[length].name
								if(name.indexOf("data-") === 0) {
									name = jQuery.camelCase( name.slice( 5 ) );
								  dataAttr(elem, name, data[name])
								}
							}
						}
					}
				}
				return data
			}

			if( typeof key === 'string' ) {
			  name = jQuery.camelCase( key.slice( 5 ) )
				dataAttr(elem, name, value)
			}

		}
		function myQuery(selector) {
			var elems = document.querySelectorAll(selector)
			elems = Array.from(elems)
			elems.data = data
			return elems
		}




		var person = $('.person')
		var people = {
		  name: "ttt",
			gender: "male"
		}
		//找数组中的每个元素，拿到每个元素的data对象；设置这个值
//		var d = person.data('love', 'hei')
//		var d = person.data()
//		console.log(person.data('love', 'hei'))
		//有key的情况下只能取数组中第一个元素
		console.log('name',person.data('gender'))
//		console.log($('#child2').data())
	</script>
</body>
</html>
